{
  "entities": {
    "Vehicle": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vehicle",
      "type": "object",
      "description": "Represents a vehicle owned by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the vehicle."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Vehicle)"
        },
        "name": {
          "type": "string",
          "description": "The name of the vehicle (e.g., 'My Car')."
        },
        "licensePlate": {
          "type": "string",
          "description": "The license plate number of the vehicle."
        },
        "fuelType": {
          "type": "string",
          "description": "The type of fuel the vehicle uses (e.g., 'Gasoline', 'Diesel', 'Ethanol')."
        },
        "initialOdometer": {
          "type": "number",
          "description": "The initial odometer reading of the vehicle in kilometers."
        },
        "isPrimary": {
          "type": "boolean",
          "description": "Indicates whether this vehicle is the user's primary vehicle."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "fuelType",
        "initialOdometer"
      ]
    },
    "FuelLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FuelLog",
      "type": "object",
      "description": "Represents a fuel fill-up record for a vehicle.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the fuel log entry."
        },
        "vehicleId": {
          "type": "string",
          "description": "Reference to Vehicle. (Relationship: Vehicle 1:N FuelLog)"
        },
        "date": {
          "type": "string",
          "description": "The date of the fuel fill-up.",
          "format": "date-time"
        },
        "gasStation": {
          "type": "string",
          "description": "The name of the gas station where the fuel was purchased."
        },
        "mileage": {
          "type": "number",
          "description": "The odometer reading at the time of the fuel fill-up."
        },
        "cost": {
          "type": "number",
          "description": "The total cost of the fuel fill-up."
        },
        "pricePerLiter": {
          "type": "number",
          "description": "The price per liter of the fuel."
        },
        "liters": {
          "type": "number",
          "description": "The number of liters of fuel purchased."
        },
        "fuelType": {
          "type": "string",
          "description": "The type of fuel purchased (e.g., 'Gasoline', 'Diesel', 'Ethanol')."
        }
      },
      "required": [
        "id",
        "vehicleId",
        "date",
        "mileage",
        "cost",
        "pricePerLiter",
        "liters",
        "fuelType"
      ]
    },
    "MaintenanceAlert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MaintenanceAlert",
      "type": "object",
      "description": "Represents a maintenance alert for a vehicle.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the maintenance alert."
        },
        "vehicleId": {
          "type": "string",
          "description": "Reference to Vehicle. (Relationship: Vehicle 1:N MaintenanceAlert)"
        },
        "description": {
          "type": "string",
          "description": "Description of the maintenance task (e.g., 'Oil change')."
        },
        "intervalKm": {
          "type": "number",
          "description": "The mileage interval at which the maintenance should be performed."
        },
        "lastPerformedOdometer": {
          "type": "number",
          "description": "The odometer reading when the maintenance was last performed."
        }
      },
      "required": [
        "id",
        "vehicleId",
        "description",
        "intervalKm"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The user's name."
        }
      },
      "required": [
        "id",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Uses path-based ownership for authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/vehicles/{vehicleId}",
        "definition": {
          "entityName": "Vehicle",
          "schema": {
            "$ref": "#/backend/entities/Vehicle"
          },
          "description": "Stores vehicle data owned by a specific user. Uses path-based ownership; each vehicle implicitly belongs to the specified user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "vehicleId",
              "description": "The unique identifier for the vehicle."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/vehicles/{vehicleId}/fuelLogs/{fuelLogId}",
        "definition": {
          "entityName": "FuelLog",
          "schema": {
            "$ref": "#/backend/entities/FuelLog"
          },
          "description": "Stores fuel log data for a specific vehicle, owned by a user. Path-based ownership ensures each fuel log belongs to the specified user and vehicle.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "vehicleId",
              "description": "The unique identifier for the vehicle."
            },
            {
              "name": "fuelLogId",
              "description": "The unique identifier for the fuel log."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/vehicles/{vehicleId}/maintenanceAlerts/{maintenanceAlertId}",
        "definition": {
          "entityName": "MaintenanceAlert",
          "schema": {
            "$ref": "#/backend/entities/MaintenanceAlert"
          },
          "description": "Stores maintenance alerts for a specific vehicle, owned by a user. Path-based ownership ensures each maintenance alert belongs to the specified user and vehicle.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "vehicleId",
              "description": "The unique identifier for the vehicle."
            },
            {
              "name": "maintenanceAlertId",
              "description": "The unique identifier for the maintenance alert."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, DBAC, and QAPs. User data, vehicle information, fuel logs, and maintenance alerts are stored in a hierarchical structure under each user's document. This approach provides clear ownership and simplifies security rules. \n\nAuthorization Independence is achieved through path-based ownership. Each user's data resides under `/users/{userId}`, eliminating the need for `get()` calls in security rules to validate ownership. Every document under the user path implicitly belongs to that user.\n\nQAPs (Rules are not Filters) are supported by segregating user data into dedicated collections, enabling secure `list` operations. For instance, listing vehicles associated with a user can be done securely under `/users/{userId}/vehicles` without exposing other users' vehicles. Similarly FuelLog and MaintenanceAlert are stored with path based ownership which allows for secure `list` operation. The design utilizes path-based ownership which simplifies data access control and allows for easy scaling of the application as the number of users and vehicles increases.\n\nGlobal roles are managed through existence checks in dedicated collections (DBAC), ensuring that custom claims are not needed. Although, the user requests does not cover this use case, it can be easily expanded."
  }
}