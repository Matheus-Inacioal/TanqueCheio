{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's display name."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "Vehicle": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vehicle",
      "type": "object",
      "description": "Represents a vehicle owned by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the vehicle.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Vehicle)"
        },
        "name": {
          "type": "string",
          "description": "Vehicle's name."
        },
        "licensePlate": {
          "type": "string",
          "description": "Vehicle's license plate number."
        },
        "fuelType": {
          "type": "string",
          "description": "Type of fuel the vehicle uses."
        },
        "initialOdometer": {
          "type": "number",
          "description": "Initial odometer reading of the vehicle."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "fuelType",
        "initialOdometer"
      ]
    },
    "FuelLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FuelLog",
      "type": "object",
      "description": "Represents a fuel fill-up record for a vehicle.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the fuel log entry.",
          "format": "uuid"
        },
        "vehicleId": {
          "type": "string",
          "description": "Reference to Vehicle. (Relationship: Vehicle 1:N FuelLog)"
        },
        "date": {
          "type": "string",
          "description": "Date of the fuel fill-up.",
          "format": "date-time"
        },
        "gasStation": {
          "type": "string",
          "description": "Name of the gas station."
        },
        "mileage": {
          "type": "number",
          "description": "Odometer reading at the time of fill-up."
        },
        "cost": {
          "type": "number",
          "description": "Total cost of the fill-up."
        },
        "pricePerLiter": {
          "type": "number",
          "description": "Price per liter of fuel."
        },
        "liters": {
          "type": "number",
          "description": "Amount of fuel filled (in liters)."
        },
        "fuelType": {
          "type": "string",
          "description": "Type of fuel used for this fill-up."
        }
      },
      "required": [
        "id",
        "vehicleId",
        "date",
        "mileage",
        "cost",
        "pricePerLiter",
        "liters",
        "fuelType"
      ]
    },
    "MaintenanceAlert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MaintenanceAlert",
      "type": "object",
      "description": "Represents a maintenance alert for a vehicle.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the maintenance alert.",
          "format": "uuid"
        },
        "vehicleId": {
          "type": "string",
          "description": "Reference to Vehicle. (Relationship: Vehicle 1:N MaintenanceAlert)"
        },
        "description": {
          "type": "string",
          "description": "Description of the maintenance task (e.g., oil change)."
        },
        "intervalKm": {
          "type": "number",
          "description": "Mileage interval for the maintenance task."
        },
        "lastPerformedKm": {
          "type": "number",
          "description": "Odometer reading when the maintenance was last performed."
        },
        "nextMaintenanceKm": {
          "type": "number",
          "description": "Odometer reading when the maintenance is next due."
        }
      },
      "required": [
        "id",
        "vehicleId",
        "description",
        "intervalKm"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Authorization: Only the user (identified by userId) can read/write their own profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/vehicles/{vehicleId}",
        "definition": {
          "entityName": "Vehicle",
          "schema": {
            "$ref": "#/backend/entities/Vehicle"
          },
          "description": "Stores vehicles owned by a specific user. Authorization: Only the user (identified by userId) can read/write vehicles under their userId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "vehicleId",
              "description": "The unique identifier for the vehicle."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/vehicles/{vehicleId}/fuelLogs/{fuelLogId}",
        "definition": {
          "entityName": "FuelLog",
          "schema": {
            "$ref": "#/backend/entities/FuelLog"
          },
          "description": "Stores fuel log entries for a specific vehicle. Authorization: Only the user (identified by userId) can read/write fuel logs associated with their vehicles.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "vehicleId",
              "description": "The unique identifier for the vehicle."
            },
            {
              "name": "fuelLogId",
              "description": "The unique identifier for the fuel log entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/vehicles/{vehicleId}/maintenanceAlerts/{maintenanceAlertId}",
        "definition": {
          "entityName": "MaintenanceAlert",
          "schema": {
            "$ref": "#/backend/entities/MaintenanceAlert"
          },
          "description": "Stores maintenance alerts for a specific vehicle. Authorization: Only the user (identified by userId) can read/write maintenance alerts associated with their vehicles.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "vehicleId",
              "description": "The unique identifier for the vehicle."
            },
            {
              "name": "maintenanceAlertId",
              "description": "The unique identifier for the maintenance alert."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and easily debuggable, adhering to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters).  Authorization Independence is achieved through denormalization, copying user IDs and roles into subcollections where necessary. Structural Segregation ensures each collection has a homogeneous security posture. Access Modeling standardizes authorization patterns using path-based ownership and membership maps.  \n\nSpecifically, user data is stored under `/users/{userId}`, providing clear ownership.  Vehicles, being owned by users, are stored under `/users/{userId}/vehicles/{vehicleId}`, continuing the path-based ownership pattern. FuelLog and MaintenanceAlert subcollections under `/users/{userId}/vehicles/{vehicleId}` inherit authorization context from their parent vehicle via path. This eliminates the need for `get()` calls in security rules, which are hard to debug and can break atomic operations. Maintenance Alerts are stored in the `/users/{userId}/vehicles/{vehicleId}/maintenanceAlerts/{maintenanceAlertId}` collection and are secured by requiring the `request.auth.uid` to match the `userId` segment in the path. This structure enables QAPs as listing operations can be secured by simply checking the `userId` in the path against `request.auth.uid`."
  }
}